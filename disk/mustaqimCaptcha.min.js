!function(t){"use strict";var e=function(i,n){this.$element=t(i),this.options=t.extend({},e.DEFAULTS,n),this.$element.css({position:"relative",width:this.options.width+"px",margin:"0 auto"}),this.init()};e.VERSION="2.0",e.Author="mustaqim@fple.com",e.DEFAULTS={width:280,height:155,PI:Math.PI,sliderL:42,sliderR:9,offset:5,loadingText:"Loading...",failedText:"Try It Again",barText:"Drag the left slider to verify",repeatIcon:"fa fa-repeat",maxLoadCount:3,localImages:function(){return"images/Pic"+Math.round(4*Math.random())+".jpg"}},t.fn.mustaqimCaptcha=function(i){return this.each(function(){var n=t(this),o=n.data("lgb.MustaqimCaptcha"),s="object"==typeof i&&i;o&&!/reset/.test(i)||(o||n.data("lgb.MustaqimCaptcha",o=new e(this,s)),"string"==typeof i&&o[i]())})},t.fn.mustaqimCaptcha.Constructor=e;var i=e.prototype;i.init=function(){this.initDOM(),this.initImg(),this.bindEvents()},i.initDOM=function(){var e=function(t,e){var i=document.createElement(t);return i.className=e,i},i=function(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i}(this.options.width-2,this.options.height),n=i.cloneNode(!0),o=e("div","sliderContainer"),s=e("i","refreshIcon "+this.options.repeatIcon),a=e("i","backIcon "+this.options.backIcon),r=e("div","sliderMask"),c=e("div","sliderbg"),l=e("div","slider"),d=e("i","fa fa-arrow-right sliderIcon"),h=e("span","sliderText");n.className="block",h.innerHTML=this.options.barText;var p=this.$element;p.append(t(i)),p.append(t(s)),p.append(t(a)),p.append(t(n)),l.appendChild(d),r.appendChild(l),o.appendChild(c),o.appendChild(r),o.appendChild(h),p.append(t(o)),Object.assign(this,{canvas:i,block:n,sliderContainer:t(o),refreshIcon:s,cancelIcon:a,slider:l,sliderMask:r,sliderIcon:d,text:t(h),canvasCtx:i.getContext("2d"),blockCtx:n.getContext("2d")})},i.initImg=function(){var e=this,i=window.navigator.userAgent.indexOf("Trident")>-1,n=this.options.sliderL+2*this.options.sliderR+3,o=function(t,n){var o=e.options.sliderL,s=e.options.sliderR,a=e.options.PI,r=e.x,c=e.y;t.beginPath(),t.moveTo(r,c),t.arc(r+o/2,c-s+2,s,.72*a,2.26*a),t.lineTo(r+o,c),t.arc(r+o+s-2,c+o/2,s,1.21*a,2.78*a),t.lineTo(r+o,c+o),t.lineTo(r,c+o),t.arc(r+s-2,c+o/2,s+.4,2.76*a,1.24*a,!0),t.lineTo(r,c),t.lineWidth=2,t.fillStyle="rgba(255, 255, 255, 0.7)",t.strokeStyle="rgba(255, 255, 255, 0.7)",t.stroke(),t[n](),t.globalCompositeOperation=i?"xor":"overlay"},s=function(t,e){return Math.round(Math.random()*(e-t)+t)},a=new Image;a.crossOrigin="Anonymous";var r=0;a.onload=function(){e.x=s(n+10,e.options.width-(n+10)),e.y=s(10+2*e.options.sliderR,e.options.height-(n+10)),o(e.canvasCtx,"fill"),o(e.blockCtx,"clip"),e.canvasCtx.drawImage(a,0,0,e.options.width-2,e.options.height),e.blockCtx.drawImage(a,0,0,e.options.width-2,e.options.height);var t=e.y-2*e.options.sliderR-1,i=e.blockCtx.getImageData(e.x-3,t,n,n);e.block.width=n,e.blockCtx.putImageData(i,0,t),e.text.text(e.text.attr("data-text"))},a.onerror=function(){r++,"file:"===window.location.protocol&&(r=e.options.maxLoadCount,console.error("can't load pic resource file from File protocal. Please try http or https")),r>=e.options.maxLoadCount?e.text.text("Failed").addClass("text-danger"):a.src=e.options.localImages()},a.setSrc=function(){var n="";if(r=0,e.text.removeClass("text-danger"),t.isFunction(e.options.setSrc)&&(n=e.options.setSrc()),n&&""!==n||(n="https://picsum.photos/"+e.options.width+"/"+e.options.height+"/?image="+Math.round(20*Math.random())),i){var o=new XMLHttpRequest;o.onloadend=function(t){var e=new FileReader;e.readAsDataURL(t.target.response),e.onloadend=function(t){a.src=t.target.result}},o.open("GET",n),o.responseType="blob",o.send()}else a.src=n},a.setSrc(),this.text.attr("data-text",this.options.barText),this.text.text(this.options.loadingText),this.img=a},i.clean=function(){this.canvasCtx.clearRect(0,0,this.options.width,this.options.height),this.blockCtx.clearRect(0,0,this.options.width,this.options.height),this.block.width=this.options.width},i.bindEvents=function(){var e=this;this.$element.on("selectstart",function(){return!1}),t(this.refreshIcon).on("click",function(){e.text.text(e.options.barText),e.reset(),t.isFunction(e.options.onRefresh)&&e.options.onRefresh.call(e.$element)}),t(this.cancelIcon).on("click",function(){window.history.back()});var i,n,o=[],s=!1,a=function(t){e.text.hasClass("text-danger")||(i=t.clientX||t.touches[0].clientX,n=t.clientY||t.touches[0].clientY,s=!0)},r=function(t){if(!s)return!1;var a=t.clientX||t.touches[0].clientX,r=t.clientY||t.touches[0].clientY,c=a-i,l=r-n;if(c<0||c+40>e.options.width)return!1;e.slider.style.left=c-1+"px";var d=(e.options.width-40-20)/(e.options.width-40)*c;e.block.style.left=d+"px",e.sliderContainer.addClass("sliderContainer_active"),e.sliderMask.style.width=c+4+"px",o.push(l)},c=function(n){if(!s)return!1;if(s=!1,(n.clientX||n.changedTouches[0].clientX)==i)return!1;e.sliderContainer.removeClass("sliderContainer_active"),e.trail=o;var{spliced:a,verified:r}=e.verify();a&&r?(e.sliderContainer.addClass("sliderContainer_success"),t.isFunction(e.options.onSuccess)&&e.options.onSuccess.call(e.$element)):(e.sliderContainer.addClass("sliderContainer_fail"),t.isFunction(e.options.onFail)&&e.options.onFail.call(e.$element),setTimeout(()=>{e.text.text(e.options.failedText),e.reset()},1e3))};this.slider.addEventListener("mousedown",a),this.slider.addEventListener("touchstart",a),document.addEventListener("mousemove",r),document.addEventListener("touchmove",r),document.addEventListener("mouseup",c),document.addEventListener("touchend",c),document.addEventListener("mousedown",function(){return!1}),document.addEventListener("touchstart",function(){return!1})},i.verify=function(){var t=function(t,e){return t+e},e=this.trail,i=e.reduce(t)/e.length,n=e.map(function(t){return t-i}),o=Math.sqrt(n.map(function(t){return t*t}).reduce(t)/e.length),s=parseInt(this.block.style.left);return{spliced:Math.abs(s-this.x)<this.options.offset,verified:0!==o}},i.reset=function(){this.sliderContainer.removeClass("sliderContainer_fail sliderContainer_success"),this.slider.style.left=0,this.block.style.left=0,this.sliderMask.style.width=0,this.clean(),this.text.attr("data-text",this.text.text()),this.text.text(this.options.loadingText),this.img.setSrc()}}(jQuery);